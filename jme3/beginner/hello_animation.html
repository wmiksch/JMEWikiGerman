<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 1.5.4"><meta name="keywords" content="beginner, intro, animation, documentation, keyinput, input, node, model"><title>jMonkeyEngine 3 Tutorial (7) - Hello Animation</title><link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"><link rel="stylesheet" href="/home/travis/build/wmiksch/JMEWikiGerman/build/asciidoc/html5/jme3/beginner/twemoji-awesome.css"></head><body class="article toc2 toc-left"><div id="header"><div id="toolbar"><a href="https://github.com/wmiksch/JMEWikiGerman/edit/master/src/docs/asciidoc/jme3/beginner/hello_animation.adoc"><i class="fa fa-pencil-square" aria-hidden="true"></i></a><a href="https://github.com/wmiksch/JMEWikiGerman/new/master/src/docs/asciidoc/jme3/beginner/"><i class="fa fa-plus-square" aria-hidden="true"></i></a><input dir="auto" style="position: relative; vertical-align: top;" spellcheck="false" autocomplete="off" class="searchbox__input aa-input" id="doc-search" name="search" placeholder="Search in the doc" required="required" type="search"></div><h1>jMonkeyEngine 3 Tutorial (7) - Hello Animation</h1><div class="details"><span class="author" id="author"></span><br><span id="revnumber">version ,</span> <span id="revdate">2016/03/17 20:48</span></div><div id="toc" class="toc2"><div id="toctitle">Inhaltsverzeichnis</div><ul class="sectlevel1"><li><a href="#sample-code">Sample Code</a></li><li><a href="#creating-and-loading-animated-models">Creating and Loading Animated Models</a></li><li><a href="#animation-controller-and-channel">Animation Controller and Channel</a></li><li><a href="#responding-to-animation-events">Responding to Animation Events</a></li><li><a href="#trigger-animations-after-user-input">Trigger Animations After User Input</a></li><li><a href="#exercises">Exercises</a><ul class="sectlevel2"><li><a href="#exercise-1-two-animations">Exercise 1: Two Animations</a></li><li><a href="#exercise-2-revealing-the-skeleton-1">Exercise 2: Revealing the Skeleton (1)</a></li><li><a href="#exercise-3-revealing-the-skeleton-2">Exercise 3: Revealing the Skeleton (2)</a></li></ul></li><li><a href="#conclusion">Conclusion</a></li></ul></div></div><div id="content"><div id="preamble"><div class="sectionbody"><div class="paragraph"><p>Previous: <a href="../../jme3/beginner/hello_material.html">Hello Material</a>,
Next: <a href="../../jme3/beginner/hello_picking.html">Hello Picking</a></p></div>
<div class="paragraph"><p>This tutorial shows how to add an animation controller and channels, and how to respond to user input by triggering an animation in a loaded model.</p></div>
<div style="text-align: center;" class="imageblock"><div class="content"><img src="../../jme3/beginner/beginner-animation.png" alt="beginner-animation.png" width="" height=""></div></div>
<div class="admonitionblock tip"><table><tr><td class="icon"><i class="fa icon-tip" title="Tip"></i></td><td class="content"><div class="paragraph"><p>To use the example assets in a new jMonkeyEngine SDK project, <b class="button">RMB</b> select your project, select <span class="menuseq"><span class="menu">Properties</span>&#160;&#9656; <span class="menuitem">Libraries</span></span> and in the <code>Compile</code> tab press <code>Add Library</code> and add the <code>jme3-test-data</code> library.</p></div></td></tr></table></div></div></div>
<div class="sect1"><h2 id="sample-code">Sample Code</h2><div class="sectionbody"><div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">jme3test.helloworld</span>;

<span class="keyword">import</span> <span class="include">com.jme3.animation.AnimChannel</span>;
<span class="keyword">import</span> <span class="include">com.jme3.animation.AnimControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.animation.AnimEventListener</span>;
<span class="keyword">import</span> <span class="include">com.jme3.animation.LoopMode</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.SimpleApplication</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.KeyInput</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.controls.ActionListener</span>;
<span class="keyword">import</span> <span class="include">com.jme3.input.controls.KeyTrigger</span>;
<span class="keyword">import</span> <span class="include">com.jme3.light.DirectionalLight</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.ColorRGBA</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.Vector3f</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Node</span>;

<span class="comment">/** Sample 7 - how to load an OgreXML model and play an animation,
 * using channels, a controller, and an AnimEventListener. */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloAnimation</span> <span class="directive">extends</span> SimpleApplication
  <span class="directive">implements</span> AnimEventListener {
  <span class="directive">private</span> AnimChannel channel;
  <span class="directive">private</span> AnimControl control;
  Node player;
  <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
    HelloAnimation app = <span class="keyword">new</span> HelloAnimation();
    app.start();
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> simpleInitApp() {
    viewPort.setBackgroundColor(ColorRGBA.LightGray);
    initKeys();
    DirectionalLight dl = <span class="keyword">new</span> DirectionalLight();
    dl.setDirection(<span class="keyword">new</span> Vector3f(-<span class="float">0.1f</span>, -<span class="float">1f</span>, -<span class="integer">1</span>).normalizeLocal());
    rootNode.addLight(dl);
    player = (Node) assetManager.loadModel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Models/Oto/Oto.mesh.xml</span><span class="delimiter">&quot;</span></span>);
    player.setLocalScale(<span class="float">0.5f</span>);
    rootNode.attachChild(player);
    control = player.getControl(AnimControl.class);
    control.addListener(<span class="local-variable">this</span>);
    channel = control.createChannel();
    channel.setAnim(<span class="string"><span class="delimiter">&quot;</span><span class="content">stand</span><span class="delimiter">&quot;</span></span>);
  }

  <span class="directive">public</span> <span class="type">void</span> onAnimCycleDone(AnimControl control, AnimChannel channel, <span class="predefined-type">String</span> animName) {
    <span class="keyword">if</span> (animName.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Walk</span><span class="delimiter">&quot;</span></span>)) {
      channel.setAnim(<span class="string"><span class="delimiter">&quot;</span><span class="content">stand</span><span class="delimiter">&quot;</span></span>, <span class="float">0.50f</span>);
      channel.setLoopMode(LoopMode.DontLoop);
      channel.setSpeed(<span class="float">1f</span>);
    }
  }

  <span class="directive">public</span> <span class="type">void</span> onAnimChange(AnimControl control, AnimChannel channel, <span class="predefined-type">String</span> animName) {
    <span class="comment">// unused</span>
  }

  <span class="comment">/** Custom Keybinding: Map named actions to inputs. */</span>
  <span class="directive">private</span> <span class="type">void</span> initKeys() {
    inputManager.addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">Walk</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> KeyTrigger(KeyInput.KEY_SPACE));
    inputManager.addListener(actionListener, <span class="string"><span class="delimiter">&quot;</span><span class="content">Walk</span><span class="delimiter">&quot;</span></span>);
  }
  <span class="directive">private</span> <span class="predefined-type">ActionListener</span> actionListener = <span class="keyword">new</span> <span class="predefined-type">ActionListener</span>() {
    <span class="directive">public</span> <span class="type">void</span> onAction(<span class="predefined-type">String</span> name, <span class="type">boolean</span> keyPressed, <span class="type">float</span> tpf) {
      <span class="keyword">if</span> (name.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Walk</span><span class="delimiter">&quot;</span></span>) &amp;&amp; !keyPressed) {
        <span class="keyword">if</span> (!channel.getAnimationName().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Walk</span><span class="delimiter">&quot;</span></span>)) {
          channel.setAnim(<span class="string"><span class="delimiter">&quot;</span><span class="content">Walk</span><span class="delimiter">&quot;</span></span>, <span class="float">0.50f</span>);
          channel.setLoopMode(LoopMode.Loop);
        }
      }
    }
  };
}</code></pre></div></div></div></div>
<div class="sect1"><h2 id="creating-and-loading-animated-models">Creating and Loading Animated Models</h2><div class="sectionbody"><div class="paragraph"><p>You create animated models with a tool such as Blender. Take some time and learn how to create your own models in these <a href="http://www.blender.org/education-help/tutorials/animation/">Blender Animation Tutorials</a>. For now, download and use a free model, such as the one included here as an example (<a href="https://github.com/jMonkeyEngine/jmonkeyengine/tree/master/jme3-testdata/src/main/resources/Models/Oto/">Oto Golem</a>, and <a href="https://github.com/jMonkeyEngine/jmonkeyengine/tree/master/jme3-testdata/src/main/resources/Models/Ninja/">Ninja</a>).</p></div>
<div class="paragraph"><p>Loading an animated model is pretty straight-forward, just as you have learned in the previous chapters. Animated Ogre models come as a set of files: The model is in <code>Oto.mesh.xml</code>, and the animation details are in <code>Oto.skeleton.xml</code>, plus the usual files for materials and textures. Check that all files of the model are together in the same <code>Model</code> subdirectory.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java">  <span class="directive">public</span> <span class="type">void</span> simpleInitApp() {
    <span class="comment">/* Displaying the model requires a light source */</span>
    DirectionalLight dl = <span class="keyword">new</span> DirectionalLight();
    dl.setDirection(<span class="keyword">new</span> Vector3f(-<span class="float">0.1f</span>, -<span class="float">1f</span>, -<span class="integer">1</span>).normalizeLocal());
    rootNode.addLight(dl);
    <span class="comment">/* load and attach the model as usual */</span>
    player = assetManager.loadModel(<span class="string"><span class="delimiter">&quot;</span><span class="content">Models/Oto/Oto.mesh.xml</span><span class="delimiter">&quot;</span></span>);
    player.setLocalScale(<span class="float">0.5f</span>); <span class="comment">// resize</span>
    rootNode.attachChild(player);
    ...
    }</code></pre></div></div>
<div class="paragraph"><p>Don&#8217;t forget to add a light source to make the material visible.</p></div></div></div>
<div class="sect1"><h2 id="animation-controller-and-channel">Animation Controller and Channel</h2><div class="sectionbody"><div class="paragraph"><p>After you load the animated model, you register it to the Animation Controller.</p></div>
<div class="ulist"><ul><li><p>The controller object gives you access to the available animation sequences.</p></li><li><p>The controller can have several channels, each channel can run one animation sequence at a time.</p></li><li><p>To run several sequences, you create several channels, and set them each to their animation.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java">  <span class="directive">private</span> AnimChannel channel;
  <span class="directive">private</span> AnimControl control;

  <span class="directive">public</span> <span class="type">void</span> simpleInitApp() {
    ...
    <span class="comment">/* Load the animation controls, listen to animation events,
     * create an animation channel, and bring the model in its default position.  */</span>
    control = player.getControl(AnimControl.class);
    control.addListener(<span class="local-variable">this</span>);
    channel = control.createChannel();
    channel.setAnim(<span class="string"><span class="delimiter">&quot;</span><span class="content">stand</span><span class="delimiter">&quot;</span></span>);
    ...</code></pre></div></div>
<div class="paragraph"><p>This line of code will return NULL if the AnimControl is not in the main node of your model.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java">control = player.getControl(AnimControl.class);</code></pre></div></div>
<div class="paragraph"><p>To check this, <b class="button">RMB</b> select your model and click &#8220;Edit in SceneComposer&#8221; if the models file extension is .j3o, or &#8220;View&#8221; if not. You can then see the tree for the model so you can locate the node the control resides in. You can access the subnode with the following code.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java">player.getChild(<span class="string"><span class="delimiter">&quot;</span><span class="content">Subnode</span><span class="delimiter">&quot;</span></span>).getControl(AnimControl.class);</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content"><div class="paragraph"><p>In response to a question about animations on different channels interefering with each other, <strong>Nehon on the jME forum <a href="http://jmonkeyengine.org/groups/general-2/forum/topic/helloanimation-animations-seem-to-be-clashing/#post-180994">wrote</a>,</strong></p></div>
<div class="paragraph"><p>“You have to consider channels as part of the skeleton that are animated. The default behavior is to use the whole skeleton for a channel.
In your example the first channel plays the walk anim, then the second channel plays the dodge animation.
Arms and feet are probably not affected by the doge animation so you can see the walk anim for them, but the rest of the body plays the dodge animation.</p></div>
<div class="paragraph"><p>Usually multiple channels are used to animate different part of the body. For example you create one channel for the lower part of the body and one for the upper part. This allow you to play a walk animation with the lower part and for example a shoot animation with the upper part. This way your character can walk while shooting.</p></div>
<div class="paragraph"><p>In your case, where you want animations to chain for the whole skeleton, you just have to use one channel.</p></div></td></tr></table></div></div></div>
<div class="sect1"><h2 id="responding-to-animation-events">Responding to Animation Events</h2><div class="sectionbody"><div class="paragraph"><p>Add <code>implements AnimEventListener</code> to the class declaration. This interface gives you access to events that notify you when a sequence is done, or when you change from one sequence to another, so you can respond to it. In this example, you reset the character to a standing position after a <code>Walk</code> cycle is done.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">HelloAnimation</span> <span class="directive">extends</span> SimpleApplication
                         <span class="directive">implements</span> AnimEventListener {
  ...

  public <span class="type">void</span> onAnimCycleDone(AnimControl control,
                              AnimChannel channel, <span class="predefined-type">String</span> animName) {
    <span class="keyword">if</span> (animName.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Walk</span><span class="delimiter">&quot;</span></span>)) {
      channel.setAnim(<span class="string"><span class="delimiter">&quot;</span><span class="content">stand</span><span class="delimiter">&quot;</span></span>, <span class="float">0.50f</span>);
      channel.setLoopMode(LoopMode.DontLoop);
      channel.setSpeed(<span class="float">1f</span>);
    }
  }
  <span class="directive">public</span> <span class="type">void</span> onAnimChange(AnimControl control, AnimChannel channel, <span class="predefined-type">String</span> animName) {
    <span class="comment">// unused</span>
  }</code></pre></div></div></div></div>
<div class="sect1"><h2 id="trigger-animations-after-user-input">Trigger Animations After User Input</h2><div class="sectionbody"><div class="paragraph"><p>There are ambient animations like animals or trees that you may want to trigger in the main event loop. In other cases, animations are triggered by user interaction, such as key input. You want to play the Walk animation when the player presses a certain key (here the spacebar), at the same time as the avatar performs the walk action and changes its location.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Initialize a new input controller (in <code>simpleInitApp()</code>).</p><div class="ulist"><ul><li><p>Write the <code>initKey()</code> convenience method and call it from <code>simpleInitApp()</code>.</p></li></ul></div></li><li><p>Add a key mapping with the name as the action you want to trigger.</p><div class="ulist"><ul><li><p>Here for example, you map <code>Walk</code> to the Spacebar key.</p></li></ul></div></li><li><p>Add an input listener for the <code>Walk</code> action.</p></li></ol></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java">  <span class="directive">private</span> <span class="type">void</span> initKeys() {
    inputManager.addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">Walk</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> KeyTrigger(KeyInput.KEY_SPACE));
    inputManager.addListener(actionListener, <span class="string"><span class="delimiter">&quot;</span><span class="content">Walk</span><span class="delimiter">&quot;</span></span>);
  }</code></pre></div></div>
<div class="paragraph"><p>To use the input controller, you need to implement the actionListener by testing for each action by name, then set the channel to the corresponding animation to run.</p></div>
<div class="ulist"><ul><li><p>The second parameter of setAnim() is the blendTime (how long the current animation should overlap with the last one).</p></li><li><p>LoopMode can be Loop (repeat), Cycle (forward then backward), and DontLoop (only once).</p></li><li><p>If needed, use channel.setSpeed() to set the speed of this animation.</p></li><li><p>Optionally, use channel.setTime() to Fast-forward or rewind to a certain moment in time of this animation.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java">  <span class="directive">private</span> <span class="predefined-type">ActionListener</span> actionListener = <span class="keyword">new</span> <span class="predefined-type">ActionListener</span>() {
    <span class="directive">public</span> <span class="type">void</span> onAction(<span class="predefined-type">String</span> name, <span class="type">boolean</span> keyPressed, <span class="type">float</span> tpf) {
        <span class="keyword">if</span> (name.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Walk</span><span class="delimiter">&quot;</span></span>) &amp;&amp; !keyPressed) {
            <span class="keyword">if</span> (!channel.getAnimationName().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Walk</span><span class="delimiter">&quot;</span></span>)){
                channel.setAnim(<span class="string"><span class="delimiter">&quot;</span><span class="content">Walk</span><span class="delimiter">&quot;</span></span>, <span class="float">0.50f</span>);
                channel.setLoopMode(LoopMode.Cycle);
            }
        }
    }
  };</code></pre></div></div></div></div>
<div class="sect2"><h3 id="exercises">Exercises</h3><div class="sect2"><h3 id="exercise-1-two-animations">Exercise 1: Two Animations</h3><div class="paragraph"><p>Make a mouse click trigger another animation sequence!</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Create a second channel in the controller.</p></li><li><p>Create a new key trigger mapping and action. (see: <a href="../../jme3/beginner/hello_input_system.html">Hello Input</a>)</p></li></ol></div>
<div class="admonitionblock tip"><table><tr><td class="icon"><i class="fa icon-tip" title="Tip"></i></td><td class="content"><div class="paragraph"><p>Do you want to find out what animation sequences are available in the model? Use:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">for</span> (<span class="predefined-type">String</span> anim : control.getAnimationNames()) {
    <span class="predefined-type">System</span>.out.println(anim);
}</code></pre></div></div></td></tr></table></div></div>
<div class="sect2"><h3 id="exercise-2-revealing-the-skeleton-1">Exercise 2: Revealing the Skeleton (1)</h3><div class="paragraph"><p>Open the <code>skeleton.xml</code> file in a text editor of your choice. You don&#8217;t have to be able to read or write these xml files (Blender does that for you) – but it is good to know how skeletons work. “There&#8217;s no magic to it!</p></div>
<div class="ulist"><ul><li><p>Note how the bones are numbered and named. All names of animated models follow a naming scheme.</p></li><li><p>Note the bone hierarchy that specifies how the bones are connected.</p></li><li><p>Note the list of animations: Each animation has a name, and several tracks. Each track tells individual bones how and when to transform. These animation steps are called keyframes.</p></li></ul></div></div>
<div class="sect2"><h3 id="exercise-3-revealing-the-skeleton-2">Exercise 3: Revealing the Skeleton (2)</h3><div class="paragraph"><p>Add the following import statements for the SkeletonDebugger and Material classes:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java">     <span class="keyword">import</span> <span class="include">com.jme3.scene.debug.SkeletonDebugger</span>;
     <span class="keyword">import</span> <span class="include">com.jme3.material.Material</span>;</code></pre></div></div>
<div class="paragraph"><p>Add the following code snippet to <code>simpleInitApp()</code> to make the bones (that you just read about) visible!</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java">     SkeletonDebugger skeletonDebug =
         <span class="keyword">new</span> SkeletonDebugger(<span class="string"><span class="delimiter">&quot;</span><span class="content">skeleton</span><span class="delimiter">&quot;</span></span>, control.getSkeleton());
     Material mat = <span class="keyword">new</span> Material(assetManager, <span class="string"><span class="delimiter">&quot;</span><span class="content">Common/MatDefs/Misc/Unshaded.j3md</span><span class="delimiter">&quot;</span></span>);
     mat.setColor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Color</span><span class="delimiter">&quot;</span></span>, ColorRGBA.Green);
     mat.getAdditionalRenderState().setDepthTest(<span class="predefined-constant">false</span>);
     skeletonDebug.setMaterial(mat);
     player.attachChild(skeletonDebug);</code></pre></div></div>
<div class="paragraph"><p>Can you identify individual bones in the skeleton?</p></div></div></div>
<div class="sect1"><h2 id="conclusion">Conclusion</h2><div class="sectionbody"><div class="paragraph"><p>Now you can load animated models, identify stored animations, and trigger animations by using onAnimCycleDone() and onAnimChange(). You also learned that you can play several animations simultaneously, by starting each in a channel of its own. This could be useful if you ever want to animate the lower and upper part of the characters body independently, for example the legs run, while the arms use a weapon.</p></div>
<div class="paragraph"><p>Now that your character can walk, wouldn&#8217;t it be cool if it could also pick up things, or aim a weapon at things, or open doors? Time to reveal the secrets of <a href="../../jme3/beginner/hello_picking.html">mouse picking</a>!</p></div>
<hr>
<div class="paragraph"><p>See also: <a href="https://docs.google.com/leaf?id=0B9hhZie2D-fEYmRkMTYwN2YtMzQ0My00NTM4LThhOTYtZTk1MTRlYTNjYTc3&amp;hl=en">Creating Animated OgreXML Models in Blender</a></p></div></div></div></div><div id="footer"><div id="footer-text">Version <br>Last updated 2020-05-23 18:26:27 +00:00</div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script>docsearch({
  apiKey: 'a736b6d93de805e26ec2f49b55013fbd',
  indexName: 'jmonkeyengine',
  inputSelector: '#doc-search',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></body></html>