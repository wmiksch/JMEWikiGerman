<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 1.5.4"><title>JMonkey Entity System Advanced</title><link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"><link rel="stylesheet" href="/home/travis/build/wmiksch/JMEWikiGerman/build/asciidoc/html5/jme3/contributions/entitysystem/twemoji-awesome.css"></head><body class="article toc2 toc-left"><div id="header"><div id="toolbar"><a href="https://github.com/wmiksch/JMEWikiGerman/edit/master/src/docs/asciidoc/jme3/contributions/entitysystem/advanced.adoc"><i class="fa fa-pencil-square" aria-hidden="true"></i></a><a href="https://github.com/wmiksch/JMEWikiGerman/new/master/src/docs/asciidoc/jme3/contributions/entitysystem/"><i class="fa fa-plus-square" aria-hidden="true"></i></a><input dir="auto" style="position: relative; vertical-align: top;" spellcheck="false" autocomplete="off" class="searchbox__input aa-input" id="doc-search" name="search" placeholder="Search in the doc" required="required" type="search"></div><h1>JMonkey Entity System Advanced</h1><div class="details"><span class="author" id="author"></span><br><span id="revnumber">version ,</span> <span id="revdate">2016/03/17 20:48</span></div><div id="toc" class="toc2"><div id="toctitle">Inhaltsverzeichnis</div><ul class="sectlevel1"><li><a href="#multithreading">Multithreading</a><ul class="sectlevel2"><li><a href="#entity-sets">Entity Sets</a></li><li><a href="#components">Components</a></li><li><a href="#what-are-systems">What are Systems?</a></li></ul></li><li><a href="#the-back-end">The Back End</a><ul class="sectlevel2"><li><a href="#hashmaps">Hashmaps</a></li><li><a href="#sql">SQL</a></li><li><a href="#hybrid">Hybrid</a></li><li><a href="#id-generation">Id Generation</a></li></ul></li></ul></div></div><div id="content"><div id="preamble"><div class="sectionbody"><div class="paragraph"><p>In this article we explain how the JMonkey Entity System looks like and why.</p></div>
<div class="paragraph"><p>If you are new to this subject please read the <a href="../../../jme3/contributions/entitysystem/introduction.html">Entity System Introduction</a> first.</p></div></div></div>
<div class="sect2"><h3 id="multithreading">Multithreading</h3><div class="paragraph"><p>One difference between the JMonkey Entity System and other Entity Systems is that you are allowed to access the system from various threads. This can give your game a huge performance boost because costly task can easily separated in an own thread.
This leads to an unique design of the components and the introduction to Entity Sets.</p></div>
<div class="sect2"><h3 id="entity-sets">Entity Sets</h3><div class="paragraph"><p>One part of this special approach are the Entity Sets. Most of the time you want to work with Entities you create an Entity Set and add the class names of the components you are interested in to the constructor.
In the background the Entity Set now creates Entity objects for all entities that contain the passed component classes.
This Entities <strong>only</strong> hold the the components the Set is interested in.
This means different Entity Sets have two different Entity objects for the same entity.
Therefore changes of one entity must be synchronized with the other entity sets.
This works with events created for every change and passed to the other entity sets.
With the method applyChanges() this entity Set will update all of their entities or remove/add new ones.
Besides after this method call you have a direct access to all added,changed and removed entities separately and there is no need to loop through all entities.</p></div></div>
<div class="sect2"><h3 id="components">Components</h3><div class="paragraph"><p>Because components have no other methods except the getter, changes are made by replacing the component of an entity with a new one. Therefore an entity can only have one component of the same class. If a component would have a setter no event would fired and parallel processing would not be possible anymore.
It is important that you only store pure data in the components because otherwise you would no longer know where you can find the logic and the approach of a clear software design would get lost.</p></div>
<div class="admonitionblock important"><table><tr><td class="icon"><i class="fa icon-important" title="Important"></i></td><td class="content"><div class="paragraph"><p>Beginners tend to add large objects like spatials and geometries to a component.
This is a big mistake because such objects contain logic and in our approach components are data only. Abstract it to a general level or store it completely in the systems.</p></div></td></tr></table></div>
<div class="admonitionblock important"><table><tr><td class="icon"><i class="fa icon-important" title="Important"></i></td><td class="content"><div class="paragraph"><p>Never subclass Component classes.</p></div></td></tr></table></div></div>
<div class="sect2"><h3 id="what-are-systems">What are Systems?</h3><div class="paragraph"><p>Simply all objects that use entities/components can be called a system.
For example <a href="../../../jme3/advanced/application_states.html">AppStates</a> can deal with different components and can easily be added to the Application.</p></div>
<div class="admonitionblock important"><table><tr><td class="icon"><i class="fa icon-important" title="Important"></i></td><td class="content"><div class="paragraph"><p>Never modify the same component from different systems.</p></div></td></tr></table></div>
<div class="paragraph"><p>If two systems are modifying the same components then there is a design flaw.
This is a sign that there is a missing component or system.</p></div></div></div>
<div class="sect2"><h3 id="the-back-end">The Back End</h3><div class="paragraph"><p>There are two different ways of storing the information:</p></div>
<div class="sect2"><h3 id="hashmaps">Hashmaps</h3><div class="paragraph"><p>For every component class a new Hashmap is created which contains the entityId as a key and the component as a value. Therefore if you need to get to know all entities which owns components of a
certain type the system will search in these Hashmaps for same entityIds.</p></div></div>
<div class="sect2"><h3 id="sql">SQL</h3><div class="paragraph"><p>All information of the components are stored in an SQL Database, this is done via reflection.
Therefore all Components need an empty constructor when they are stored in a database.
Otherwise it is not possible to load the Component.</p></div>
<div class="paragraph"><p>Because SQL librarys can be different this Entity System only concentrate on working with hsqldb.
<a href="http://hsqldb.org/">http://hsqldb.org/</a></p></div></div>
<div class="sect2"><h3 id="hybrid">Hybrid</h3><div class="paragraph"><p>Because saving/loading the component objects from a SQL Database is slow this does not work for components who are changed recently. (PositionComponent)
On the other hand checking weather an entity owns a special component ist faster in a SQL database.
To keep both benefits there is the Hybrid approach:</p></div>
<div class="ulist"><ul><li><p>Components are put into a Hashmap.</p></li><li><p>Persistent Components are stored in the SQL database.</p></li></ul></div></div>
<div class="sect2"><h3 id="id-generation">Id Generation</h3><div class="paragraph"><p>Every entity has a unique id which is a long.
Ids are not reused because afterward they would not be unique anymore which would cause a huge penalty.</p></div>
<div class="admonitionblock tip"><table><tr><td class="icon"><i class="fa icon-tip" title="Tip"></i></td><td class="content"><div class="paragraph"><p>Often people are scared that they would ran out of ids:
If you create a new entity every nano second you would need roughly 585 years before it wraps.</p></div></td></tr></table></div></div></div></div><div id="footer"><div id="footer-text">Version <br>Last updated 2020-06-11 10:57:02 +00:00</div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script>docsearch({
  apiKey: 'a736b6d93de805e26ec2f49b55013fbd',
  indexName: 'jmonkeyengine',
  inputSelector: '#doc-search',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></body></html>