<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 1.5.4"><title>loading_screen</title><link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"><link rel="stylesheet" href="/home/travis/build/wmiksch/JMEWikiGerman/build/asciidoc/html5/jme3/advanced/twemoji-awesome.css"></head><body class="article toc2 toc-left"><div id="header"><div id="toolbar"><a href="https://github.com/wmiksch/JMEWikiGerman/edit/master/src/docs/asciidoc/jme3/advanced/loading_screen.adoc"><i class="fa fa-pencil-square" aria-hidden="true"></i></a><a href="https://github.com/wmiksch/JMEWikiGerman/new/master/src/docs/asciidoc/jme3/advanced/"><i class="fa fa-plus-square" aria-hidden="true"></i></a><input dir="auto" style="position: relative; vertical-align: top;" spellcheck="false" autocomplete="off" class="searchbox__input aa-input" id="doc-search" name="search" placeholder="Search in the doc" required="required" type="search"></div><h1>loading_screen</h1><div class="details"><span class="author" id="author"></span><br><span id="revnumber">version ,</span> <span id="revdate">2016/03/17 20:48</span></div><div id="toc" class="toc2"><div id="toctitle">Inhaltsverzeichnis</div><ul class="sectlevel1"><li><a href="#nifty-loading-screen-progress-bar">Nifty Loading Screen (Progress Bar)</a><ul class="sectlevel2"><li><a href="#understanding-nifty-xml">Understanding Nifty XML</a></li></ul></li><li><a href="#creating-the-bindings-to-use-the-nifty-xml">Creating the bindings to use the Nifty XML</a><ul class="sectlevel2"><li><a href="#updating-progress-bar-over-a-number-of-frames">Updating progress bar over a number of frames</a></li><li><a href="#using-multithreading">Using multithreading</a></li></ul></li></ul></div></div><div id="content"><div class="sect2"><h3 id="nifty-loading-screen-progress-bar">Nifty Loading Screen (Progress Bar)</h3><div class="paragraph"><p>This example will use the existing hello terrain as an example.
It will require these 2 images inside Assets/Interface/ (save them as border.png and inner.png respectively).</p></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/advanced/inner1.png" alt="inner1.png" width="" height=""></span></p></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/advanced/border1.png" alt="border1.png" width="" height=""></span></p></div>
<div class="paragraph"><p>You need to add the jme3-niftygui and <a href="../../sdk/sample_code.html#jme3testdata-assets">jme3-test-data</a> libraries.</p></div>
<div class="paragraph"><p>You will need to set your projects source to JDK 8.</p></div>
<div class="paragraph"><p>This is the progress bar at 90%:</p></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/advanced/loadingscreen.png" alt="loadingscreen.png" width="" height=""></span></p></div>
<div class="paragraph"><p>nifty_loading.xml</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;nifty&gt;</span>
    <span class="tag">&lt;useStyles</span> <span class="attribute-name">filename</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nifty-default-styles.xml</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;useControls</span> <span class="attribute-name">filename</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nifty-default-controls.xml</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

    <span class="tag">&lt;controlDefinition</span> <span class="attribute-name">name</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">loadingbar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">controller</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">jme3test.TestLoadingScreen</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;image</span> <span class="attribute-name">filename</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Interface/border.png</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">childLayout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">absolute</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">imageMode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resize:15,2,15,15,15,2,15,2,15,2,15,15</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;image</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">progressbar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">x</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">y</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">filename</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Interface/inner.png</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">32px</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100%</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">imageMode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resize:15,2,15,15,15,2,15,2,15,2,15,15</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/image&gt;</span>
    <span class="tag">&lt;/controlDefinition&gt;</span>

    <span class="tag">&lt;screen</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">controller</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">jme3test.TestLoadingScreen</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;layer</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">layer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">childLayout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;panel</span> <span class="attribute-name">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">panel2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30%</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50%</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">valign</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">childLayout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vertical</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">visibleToMouse</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;control</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">startGame</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">button</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">backgroundColor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#0000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">label</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Load Game</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;interact</span> <span class="attribute-name">onClick</span>=<span class="string"><span class="delimiter">&quot;</span>showLoadingMenu()<span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                <span class="tag">&lt;/control&gt;</span>
            <span class="tag">&lt;/panel&gt;</span>
        <span class="tag">&lt;/layer&gt;</span>
    <span class="tag">&lt;/screen&gt;</span>

    <span class="tag">&lt;screen</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loadlevel</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">controller</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">jme3test.TestLoadingScreen</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;layer</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loadinglayer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">childLayout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">backgroundColor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#000000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;panel</span> <span class="attribute-name">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">loadingpanel</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">childLayout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vertical</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">valign</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">32px</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">70%</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;control</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loadingbar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">valign</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100%</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100%</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                <span class="tag">&lt;control</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loadingtext</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">text</span>=<span class="string"><span class="delimiter">&quot;</span>                                                  <span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/panel&gt;</span>
        <span class="tag">&lt;/layer&gt;</span>
    <span class="tag">&lt;/screen&gt;</span>

    <span class="tag">&lt;screen</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">end</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">controller</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">jme3test.TestLoadingScreen</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;/screen&gt;</span>

<span class="tag">&lt;/nifty&gt;</span></code></pre></div></div>
<div class="sect2"><h3 id="understanding-nifty-xml">Understanding Nifty XML</h3><div class="paragraph"><p>The progress bar and text is done statically using nifty XML.
A custom control is created, which represents the progress bar.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;controlDefinition</span> <span class="attribute-name">name</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">loadingbar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">controller</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">jme3test.TestLoadingScreen</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;image</span> <span class="attribute-name">filename</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Interface/border.png</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">childLayout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">absolute</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">imageMode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resize:15,2,15,15,15,2,15,2,15,2,15,15</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;image</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">progressbar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">x</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">y</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">filename</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Interface/inner.png</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">32px</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100%</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">imageMode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">resize:15,2,15,15,15,2,15,2,15,2,15,15</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/image&gt;</span>
<span class="tag">&lt;/controlDefinition&gt;</span></code></pre></div></div>
<div class="paragraph"><p>This screen simply displays a button in the middle of the screen, which could be seen as a simple main menu UI.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;screen</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">controller</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">jme3test.TestLoadingScreen</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;layer</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">layer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">childLayout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;panel</span> <span class="attribute-name">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">panel2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30%</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50%</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">valign</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">childLayout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vertical</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">visibleToMouse</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;control</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">startGame</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">button</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">backgroundColor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#0000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">label</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Load Game</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <span class="tag">&lt;interact</span> <span class="attribute-name">onClick</span>=<span class="string"><span class="delimiter">&quot;</span>showLoadingMenu()<span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/control&gt;</span>
        <span class="tag">&lt;/panel&gt;</span>
    <span class="tag">&lt;/layer&gt;</span>
<span class="tag">&lt;/screen&gt;</span></code></pre></div></div>
<div class="paragraph"><p>This screen displays our custom progress bar control with a text control.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;screen</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loadlevel</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">controller</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">jme3test.TestLoadingScreen</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;layer</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loadinglayer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">childLayout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">backgroundColor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#000000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;panel</span> <span class="attribute-name">id</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">loadingpanel</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">childLayout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vertical</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">valign</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">32px</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">400px</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;control</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loadingbar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">valign</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">400px</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">32px</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;control</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loadingtext</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">center</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">text</span>=<span class="string"><span class="delimiter">&quot;</span>                                                  <span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/panel&gt;</span>
    <span class="tag">&lt;/layer&gt;</span>
<span class="tag">&lt;/screen&gt;</span></code></pre></div></div></div></div>
<div class="sect2"><h3 id="creating-the-bindings-to-use-the-nifty-xml">Creating the bindings to use the Nifty XML</h3><div class="paragraph"><p>There are 3 main ways to update a progress bar. To understand why these methods are necessary, an understanding of the graphics pipeline is needed.</p></div>
<div class="paragraph"><p>Something like this in a single thread will not work:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java">load_scene();
update_bar(<span class="integer">30</span>%);
load_characters();
update_bar(<span class="integer">60</span>%);
load_sounds();
update_bar(<span class="integer">100</span>%);</code></pre></div></div>
<div class="paragraph"><p>If you do all of this in a single frame, then it is sent to the graphics card only after the whole code block has executed. By this time the bar has reached 100% and the game has already begun – for the user, the progressbar on the screen would not have visibly changed.</p></div>
<div class="paragraph"><p>The 2 main good solutions are:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Updating explicitly over many frames</p></li><li><p>Multi-threading</p></li></ol></div>
<div class="sect2"><h3 id="updating-progress-bar-over-a-number-of-frames">Updating progress bar over a number of frames</h3><div class="paragraph"><p>The idea is to break down the loading of the game into discrete parts.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">jme3test</span>;

<span class="keyword">import</span> <span class="include">com.jme3.app.SimpleApplication</span>;
<span class="keyword">import</span> <span class="include">com.jme3.material.Material</span>;
<span class="keyword">import</span> <span class="include">com.jme3.niftygui.NiftyJmeDisplay</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">com.jme3.niftygui.NiftyJmeDisplay.newNiftyJmeDisplay</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.Camera</span>;
<span class="keyword">import</span> <span class="include">com.jme3.terrain.geomipmap.TerrainLodControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.terrain.geomipmap.TerrainQuad</span>;
<span class="keyword">import</span> <span class="include">com.jme3.terrain.heightmap.AbstractHeightMap</span>;
<span class="keyword">import</span> <span class="include">com.jme3.terrain.heightmap.ImageBasedHeightMap</span>;
<span class="keyword">import</span> <span class="include">com.jme3.texture.Texture</span>;
<span class="keyword">import</span> <span class="include">com.jme3.texture.Texture.WrapMode</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.Nifty</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.controls.Controller</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.controls.Parameters</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.elements.Element</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.elements.render.TextRenderer</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.input.NiftyInputEvent</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.screen.Screen</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.screen.ScreenController</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.tools.SizeValue</span>;
<span class="keyword">import</span> <span class="include">java.util.ArrayList</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="comment">/**
 * This is the TestLoadingScreen Class of your Game. You should only do
 * initialization here. Move your Logic into AppStates or Controls
 *
 * @author normenhansen
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestLoadingScreen</span> <span class="directive">extends</span> SimpleApplication <span class="directive">implements</span>
        ScreenController, Controller {

    <span class="directive">private</span> NiftyJmeDisplay niftyDisplay;
    <span class="directive">private</span> Nifty nifty;
    <span class="directive">private</span> <span class="predefined-type">Element</span> progressBarElement;
    <span class="directive">private</span> TerrainQuad terrain;
    <span class="directive">private</span> Material mat_terrain;
    <span class="directive">private</span> <span class="type">float</span> frameCount = <span class="integer">0</span>;
    <span class="directive">private</span> <span class="type">boolean</span> load = <span class="predefined-constant">false</span>;
    <span class="directive">private</span> TextRenderer textRenderer;

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        TestLoadingScreen app = <span class="keyword">new</span> TestLoadingScreen();
        app.start();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> simpleInitApp() {
        flyCam.setEnabled(<span class="predefined-constant">false</span>);
        niftyDisplay = newNiftyJmeDisplay(assetManager,
                inputManager,
                audioRenderer,
                guiViewPort);
        nifty = niftyDisplay.getNifty();

        nifty.fromXml(<span class="string"><span class="delimiter">&quot;</span><span class="content">Interface/nifty_loading.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span>, <span class="local-variable">this</span>);

        guiViewPort.addProcessor(niftyDisplay);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> simpleUpdate(<span class="type">float</span> tpf) {

        <span class="keyword">if</span> (load) { <span class="comment">//loading is done over many frames</span>
            <span class="keyword">if</span> (frameCount == <span class="integer">1</span>) {
                <span class="predefined-type">Element</span> element = nifty.getScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">loadlevel</span><span class="delimiter">&quot;</span></span>).findElementById(
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">loadingtext</span><span class="delimiter">&quot;</span></span>);
                textRenderer = element.getRenderer(TextRenderer.class);

                mat_terrain = <span class="keyword">new</span> Material(assetManager,
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Common/MatDefs/Terrain/Terrain.j3md</span><span class="delimiter">&quot;</span></span>);
                mat_terrain.setTexture(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alpha</span><span class="delimiter">&quot;</span></span>, assetManager.loadTexture(
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Textures/Terrain/splat/alphamap.png</span><span class="delimiter">&quot;</span></span>));
                setProgress(<span class="float">0.2f</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Loading grass</span><span class="delimiter">&quot;</span></span>);

            } <span class="keyword">else</span> <span class="keyword">if</span> (frameCount == <span class="integer">2</span>) {
                Texture grass = assetManager.loadTexture(
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Textures/Terrain/splat/grass.jpg</span><span class="delimiter">&quot;</span></span>);
                grass.setWrap(WrapMode.Repeat);
                mat_terrain.setTexture(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tex1</span><span class="delimiter">&quot;</span></span>, grass);
                mat_terrain.setFloat(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tex1Scale</span><span class="delimiter">&quot;</span></span>, <span class="float">64f</span>);
                setProgress(<span class="float">0.4f</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Loading dirt</span><span class="delimiter">&quot;</span></span>);

            } <span class="keyword">else</span> <span class="keyword">if</span> (frameCount == <span class="integer">3</span>) {
                Texture dirt = assetManager.loadTexture(
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Textures/Terrain/splat/dirt.jpg</span><span class="delimiter">&quot;</span></span>);

                dirt.setWrap(WrapMode.Repeat);
                mat_terrain.setTexture(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tex2</span><span class="delimiter">&quot;</span></span>, dirt);
                mat_terrain.setFloat(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tex2Scale</span><span class="delimiter">&quot;</span></span>, <span class="float">32f</span>);
                setProgress(<span class="float">0.5f</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Loading rocks</span><span class="delimiter">&quot;</span></span>);

            } <span class="keyword">else</span> <span class="keyword">if</span> (frameCount == <span class="integer">4</span>) {
                Texture rock = assetManager.loadTexture(
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Textures/Terrain/splat/road.jpg</span><span class="delimiter">&quot;</span></span>);

                rock.setWrap(WrapMode.Repeat);

                mat_terrain.setTexture(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tex3</span><span class="delimiter">&quot;</span></span>, rock);
                mat_terrain.setFloat(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tex3Scale</span><span class="delimiter">&quot;</span></span>, <span class="float">128f</span>);
                setProgress(<span class="float">0.6f</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Creating terrain</span><span class="delimiter">&quot;</span></span>);

            } <span class="keyword">else</span> <span class="keyword">if</span> (frameCount == <span class="integer">5</span>) {
                AbstractHeightMap heightmap = <span class="predefined-constant">null</span>;
                Texture heightMapImage = assetManager.loadTexture(
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Textures/Terrain/splat/mountains512.png</span><span class="delimiter">&quot;</span></span>);
                heightmap = <span class="keyword">new</span> ImageBasedHeightMap(heightMapImage.getImage());

                heightmap.load();
                terrain = <span class="keyword">new</span> TerrainQuad(<span class="string"><span class="delimiter">&quot;</span><span class="content">my terrain</span><span class="delimiter">&quot;</span></span>, <span class="integer">65</span>, <span class="integer">513</span>, heightmap.
                        getHeightMap());
                setProgress(<span class="float">0.8f</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Positioning terrain</span><span class="delimiter">&quot;</span></span>);

            } <span class="keyword">else</span> <span class="keyword">if</span> (frameCount == <span class="integer">6</span>) {
                terrain.setMaterial(mat_terrain);

                terrain.setLocalTranslation(<span class="integer">0</span>, -<span class="integer">100</span>, <span class="integer">0</span>);
                terrain.setLocalScale(<span class="float">2f</span>, <span class="float">1f</span>, <span class="float">2f</span>);
                rootNode.attachChild(terrain);
                setProgress(<span class="float">0.9f</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Loading cameras</span><span class="delimiter">&quot;</span></span>);

            } <span class="keyword">else</span> <span class="keyword">if</span> (frameCount == <span class="integer">7</span>) {
                <span class="predefined-type">List</span>&lt;Camera&gt; cameras = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
                cameras.add(getCamera());
                TerrainLodControl control = <span class="keyword">new</span> TerrainLodControl(terrain,
                        cameras);
                terrain.addControl(control);
                setProgress(<span class="float">1f</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Loading complete</span><span class="delimiter">&quot;</span></span>);

            } <span class="keyword">else</span> <span class="keyword">if</span> (frameCount == <span class="integer">8</span>) {
                nifty.gotoScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">end</span><span class="delimiter">&quot;</span></span>);
                nifty.exit();
                guiViewPort.removeProcessor(niftyDisplay);
                flyCam.setEnabled(<span class="predefined-constant">true</span>);
                flyCam.setMoveSpeed(<span class="integer">50</span>);
            }

            frameCount++;
        }
    }

    <span class="directive">public</span> <span class="type">void</span> setProgress(<span class="directive">final</span> <span class="type">float</span> progress, <span class="predefined-type">String</span> loadingText) {
        <span class="directive">final</span> <span class="type">int</span> MIN_WIDTH = <span class="integer">32</span>;
        <span class="type">int</span> pixelWidth = (<span class="type">int</span>) (MIN_WIDTH + (progressBarElement.getParent().
                getWidth() - MIN_WIDTH) * progress);
        progressBarElement.setConstraintWidth(<span class="keyword">new</span> SizeValue(pixelWidth + <span class="string"><span class="delimiter">&quot;</span><span class="content">px</span><span class="delimiter">&quot;</span></span>));
        progressBarElement.getParent().layoutElements();

        textRenderer.setText(loadingText);
    }

    <span class="directive">public</span> <span class="type">void</span> showLoadingMenu() {
        nifty.gotoScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">loadlevel</span><span class="delimiter">&quot;</span></span>);
        load = <span class="predefined-constant">true</span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onStartScreen() {
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onEndScreen() {
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> bind(Nifty nifty, Screen screen) {
        progressBarElement = nifty.getScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">loadlevel</span><span class="delimiter">&quot;</span></span>).findElementById(
                <span class="string"><span class="delimiter">&quot;</span><span class="content">progressbar</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="comment">// methods for Controller</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> inputEvent(<span class="directive">final</span> NiftyInputEvent inputEvent) {
        <span class="keyword">return</span> <span class="predefined-constant">false</span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onFocus(<span class="type">boolean</span> getFocus) {
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> bind(Nifty nifty, Screen screen, <span class="predefined-type">Element</span> elmnt,
            Parameters prmtrs) {
        progressBarElement = elmnt.findElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">progressbar</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(Parameters prmtrs) {
    }

}</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">Try and add all controls near the end, as their update loops may begin executing.</td></tr></table></div></div>
<div class="sect2"><h3 id="using-multithreading">Using multithreading</h3><div class="paragraph"><p>For more info on multithreading: <a href="../../jme3/advanced/multithreading.html">The jME3 Threading Model</a></p></div>
<div class="paragraph"><p>Make sure to change the XML file to point the controller to TestLoadingScreen*1*.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">jme3test</span>;

<span class="keyword">import</span> <span class="include">com.jme3.app.SimpleApplication</span>;
<span class="keyword">import</span> <span class="include">com.jme3.material.Material</span>;
<span class="keyword">import</span> <span class="include">com.jme3.niftygui.NiftyJmeDisplay</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">com.jme3.niftygui.NiftyJmeDisplay.newNiftyJmeDisplay</span>;
<span class="keyword">import</span> <span class="include">com.jme3.renderer.Camera</span>;
<span class="keyword">import</span> <span class="include">com.jme3.terrain.geomipmap.TerrainLodControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.terrain.geomipmap.TerrainQuad</span>;
<span class="keyword">import</span> <span class="include">com.jme3.terrain.heightmap.AbstractHeightMap</span>;
<span class="keyword">import</span> <span class="include">com.jme3.terrain.heightmap.ImageBasedHeightMap</span>;
<span class="keyword">import</span> <span class="include">com.jme3.texture.Texture</span>;
<span class="keyword">import</span> <span class="include">com.jme3.texture.Texture.WrapMode</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.Nifty</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.controls.Controller</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.controls.Parameters</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.elements.Element</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.elements.render.TextRenderer</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.input.NiftyInputEvent</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.screen.Screen</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.screen.ScreenController</span>;
<span class="keyword">import</span> <span class="include">de.lessvoid.nifty.tools.SizeValue</span>;
<span class="keyword">import</span> <span class="include">java.util.ArrayList</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="keyword">import</span> <span class="include">java.util.concurrent.Callable</span>;
<span class="keyword">import</span> <span class="include">java.util.concurrent.ExecutorService</span>;
<span class="keyword">import</span> <span class="include">java.util.concurrent.Executors</span>;
<span class="keyword">import</span> <span class="include">java.util.concurrent.Future</span>;
<span class="keyword">import</span> <span class="include">java.util.concurrent.ScheduledExecutorService</span>;
<span class="keyword">import</span> <span class="include">java.util.concurrent.TimeUnit</span>;
<span class="keyword">import</span> <span class="include">java.util.logging.Level</span>;
<span class="keyword">import</span> <span class="include">java.util.logging.Logger</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">TestLoadingScreen1</span> <span class="directive">extends</span> SimpleApplication <span class="directive">implements</span>
        ScreenController, Controller {

    <span class="directive">private</span> NiftyJmeDisplay niftyDisplay;
    <span class="directive">private</span> Nifty nifty;
    <span class="directive">private</span> <span class="predefined-type">Element</span> progressBarElement;
    <span class="directive">private</span> TerrainQuad terrain;
    <span class="directive">private</span> Material mat_terrain;
    <span class="directive">private</span> <span class="type">boolean</span> load = <span class="predefined-constant">false</span>;
    <span class="directive">private</span> <span class="predefined-type">ScheduledExecutorService</span> exec = <span class="predefined-type">Executors</span>.newScheduledThreadPool(<span class="integer">2</span>);
    <span class="directive">private</span> <span class="predefined-type">Future</span> loadFuture = <span class="predefined-constant">null</span>;
    <span class="directive">private</span> TextRenderer textRenderer;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> LOG = <span class="predefined-type">Logger</span>.getLogger(TestLoadingScreen1.class.
            getName());

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        TestLoadingScreen1 app = <span class="keyword">new</span> TestLoadingScreen1();
        app.start();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> simpleInitApp() {
        flyCam.setEnabled(<span class="predefined-constant">false</span>);
        niftyDisplay = newNiftyJmeDisplay(assetManager,
                inputManager,
                audioRenderer,
                guiViewPort);
        nifty = niftyDisplay.getNifty();

        nifty.fromXml(<span class="string"><span class="delimiter">&quot;</span><span class="content">Interface/nifty_loading.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span>, <span class="local-variable">this</span>);

        guiViewPort.addProcessor(niftyDisplay);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> simpleUpdate(<span class="type">float</span> tpf) {
        <span class="keyword">if</span> (load) {
            <span class="keyword">if</span> (loadFuture == <span class="predefined-constant">null</span>) {
                <span class="comment">//if we have not started loading, submit Callable to executor</span>
                loadFuture = exec.submit(loadingCallable);
            }
            <span class="comment">//check if the execution on the other thread is done</span>
            <span class="keyword">if</span> (loadFuture.isDone()) {
                <span class="comment">//these calls have to be done on the update loop thread,</span>
                <span class="comment">//especially attaching the terrain to the rootNode</span>
                <span class="comment">//after it is attached, it's managed by the update loop thread</span>
                <span class="comment">// and may not be modified from any other thread anymore!</span>
                nifty.gotoScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">end</span><span class="delimiter">&quot;</span></span>);
                nifty.exit();
                guiViewPort.removeProcessor(niftyDisplay);
                flyCam.setEnabled(<span class="predefined-constant">true</span>);
                flyCam.setMoveSpeed(<span class="integer">50</span>);
                rootNode.attachChild(terrain);
                load = <span class="predefined-constant">false</span>;
            }
        }
    }
    <span class="comment">//This is the callable that contains the code that is run on the other</span>
    <span class="comment">//thread.</span>
    <span class="comment">//Since the assetmananger is threadsafe, it can be used to load data from</span>
    <span class="comment">//any thread.</span>
    <span class="comment">//We do *not* attach the objects to the rootNode here!</span>
    <span class="predefined-type">Callable</span>&lt;<span class="predefined-type">Void</span>&gt; loadingCallable = <span class="keyword">new</span> <span class="predefined-type">Callable</span>&lt;<span class="predefined-type">Void</span>&gt;() {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Void</span> call() {

            <span class="predefined-type">Element</span> element = nifty.getScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">loadlevel</span><span class="delimiter">&quot;</span></span>).findElementById(
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">loadingtext</span><span class="delimiter">&quot;</span></span>);
            textRenderer = element.getRenderer(TextRenderer.class);

            mat_terrain = <span class="keyword">new</span> Material(assetManager,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Common/MatDefs/Terrain/Terrain.j3md</span><span class="delimiter">&quot;</span></span>);
            mat_terrain.setTexture(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alpha</span><span class="delimiter">&quot;</span></span>, assetManager.loadTexture(
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Textures/Terrain/splat/alphamap.png</span><span class="delimiter">&quot;</span></span>));
            <span class="comment">//setProgress is thread safe (see below)</span>
            setProgress(<span class="float">0.2f</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Loading grass</span><span class="delimiter">&quot;</span></span>);

            Texture grass = assetManager.loadTexture(
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Textures/Terrain/splat/grass.jpg</span><span class="delimiter">&quot;</span></span>);
            grass.setWrap(WrapMode.Repeat);
            mat_terrain.setTexture(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tex1</span><span class="delimiter">&quot;</span></span>, grass);
            mat_terrain.setFloat(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tex1Scale</span><span class="delimiter">&quot;</span></span>, <span class="float">64f</span>);
            setProgress(<span class="float">0.4f</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Loading dirt</span><span class="delimiter">&quot;</span></span>);

            Texture dirt = assetManager.loadTexture(
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Textures/Terrain/splat/dirt.jpg</span><span class="delimiter">&quot;</span></span>);

            dirt.setWrap(WrapMode.Repeat);
            mat_terrain.setTexture(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tex2</span><span class="delimiter">&quot;</span></span>, dirt);
            mat_terrain.setFloat(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tex2Scale</span><span class="delimiter">&quot;</span></span>, <span class="float">32f</span>);
            setProgress(<span class="float">0.5f</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Loading rocks</span><span class="delimiter">&quot;</span></span>);

            Texture rock = assetManager.loadTexture(
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Textures/Terrain/splat/road.jpg</span><span class="delimiter">&quot;</span></span>);

            rock.setWrap(WrapMode.Repeat);

            mat_terrain.setTexture(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tex3</span><span class="delimiter">&quot;</span></span>, rock);
            mat_terrain.setFloat(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tex3Scale</span><span class="delimiter">&quot;</span></span>, <span class="float">128f</span>);
            setProgress(<span class="float">0.6f</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Creating terrain</span><span class="delimiter">&quot;</span></span>);

            AbstractHeightMap heightmap = <span class="predefined-constant">null</span>;
            Texture heightMapImage = assetManager.loadTexture(
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Textures/Terrain/splat/mountains512.png</span><span class="delimiter">&quot;</span></span>);
            heightmap = <span class="keyword">new</span> ImageBasedHeightMap(heightMapImage.getImage());

            heightmap.load();
            terrain = <span class="keyword">new</span> TerrainQuad(<span class="string"><span class="delimiter">&quot;</span><span class="content">my terrain</span><span class="delimiter">&quot;</span></span>, <span class="integer">65</span>, <span class="integer">513</span>, heightmap.
                    getHeightMap());
            setProgress(<span class="float">0.8f</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Positioning terrain</span><span class="delimiter">&quot;</span></span>);

            terrain.setMaterial(mat_terrain);

            terrain.setLocalTranslation(<span class="integer">0</span>, -<span class="integer">100</span>, <span class="integer">0</span>);
            terrain.setLocalScale(<span class="float">2f</span>, <span class="float">1f</span>, <span class="float">2f</span>);
            setProgress(<span class="float">0.9f</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Loading cameras</span><span class="delimiter">&quot;</span></span>);

            <span class="predefined-type">List</span>&lt;Camera&gt; cameras = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
            cameras.add(getCamera());
            TerrainLodControl control = <span class="keyword">new</span> TerrainLodControl(terrain, cameras);
            terrain.addControl(control);
            setProgress(<span class="float">1f</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Loading complete</span><span class="delimiter">&quot;</span></span>);

            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }
    };

    <span class="directive">public</span> <span class="type">void</span> setProgress(<span class="directive">final</span> <span class="type">float</span> progress, <span class="directive">final</span> <span class="predefined-type">String</span> loadingText) {
        <span class="comment">//Since this method is called from another thread, we enqueue the</span>
        <span class="comment">//changes to the progressbar to the update loop thread.</span>
        enqueue(() -&gt; {
            <span class="directive">final</span> <span class="type">int</span> MIN_WIDTH = <span class="integer">32</span>;
            <span class="type">int</span> pixelWidth = (<span class="type">int</span>) (MIN_WIDTH + (progressBarElement.getParent().
                    getWidth() - MIN_WIDTH) * progress);
            progressBarElement.setConstraintWidth(<span class="keyword">new</span> SizeValue(pixelWidth
                    + <span class="string"><span class="delimiter">&quot;</span><span class="content">px</span><span class="delimiter">&quot;</span></span>));
            progressBarElement.getParent().layoutElements();

            textRenderer.setText(loadingText);
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        });

    }

    <span class="directive">public</span> <span class="type">void</span> showLoadingMenu() {
        nifty.gotoScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">loadlevel</span><span class="delimiter">&quot;</span></span>);
        load = <span class="predefined-constant">true</span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onStartScreen() {
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onEndScreen() {
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> bind(Nifty nifty, Screen screen) {
        progressBarElement = nifty.getScreen(<span class="string"><span class="delimiter">&quot;</span><span class="content">loadlevel</span><span class="delimiter">&quot;</span></span>).findElementById(
                <span class="string"><span class="delimiter">&quot;</span><span class="content">progressbar</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="comment">// methods for Controller</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> inputEvent(<span class="directive">final</span> NiftyInputEvent inputEvent) {
        <span class="keyword">return</span> <span class="predefined-constant">false</span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onFocus(<span class="type">boolean</span> getFocus) {
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> destroy() {
        <span class="local-variable">super</span>.destroy();
        shutdownAndAwaitTermination(exec);
    }

    <span class="comment">//standard shutdown process for executor</span>
    <span class="directive">private</span> <span class="type">void</span> shutdownAndAwaitTermination(<span class="predefined-type">ExecutorService</span> pool) {
        pool.shutdown(); <span class="comment">// Disable new tasks from being submitted</span>
        <span class="keyword">try</span> {
            <span class="comment">// Wait a while for existing tasks to terminate</span>
            <span class="keyword">if</span> (!pool.awaitTermination(<span class="integer">6</span>, <span class="predefined-type">TimeUnit</span>.SECONDS)) {
                pool.shutdownNow(); <span class="comment">// Cancel currently executing tasks</span>
                <span class="comment">// Wait a while for tasks to respond to being cancelled</span>
                <span class="keyword">if</span> (!pool.awaitTermination(<span class="integer">6</span>, <span class="predefined-type">TimeUnit</span>.SECONDS)) {
                    LOG.log(<span class="predefined-type">Level</span>.SEVERE, <span class="string"><span class="delimiter">&quot;</span><span class="content">Pool did not terminate {0}</span><span class="delimiter">&quot;</span></span>, pool);
                }
            }
        } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> ie) {
            <span class="comment">// (Re-)Cancel if current thread also interrupted</span>
            pool.shutdownNow();
            <span class="comment">// Preserve interrupt status</span>
            <span class="predefined-type">Thread</span>.currentThread().interrupt();
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> bind(Nifty nifty, Screen screen, <span class="predefined-type">Element</span> elmnt,
            Parameters prmtrs) {
        progressBarElement = elmnt.findElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">progressbar</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(Parameters prmtrs) {
    }

}</code></pre></div></div></div></div></div><div id="footer"><div id="footer-text">Version <br>Last updated 2020-06-11 12:23:11 +00:00</div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script>docsearch({
  apiKey: 'a736b6d93de805e26ec2f49b55013fbd',
  indexName: 'jmonkeyengine',
  inputSelector: '#doc-search',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></body></html>