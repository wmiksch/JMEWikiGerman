<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 1.5.4"><title>3ds Max Bone Animation to JME3 using OgreMax plugin</title><link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"><link rel="stylesheet" href="/home/travis/build/wmiksch/JMEWikiGerman/build/asciidoc/html5/jme3/external/twemoji-awesome.css"></head><body class="article toc2 toc-left"><div id="header"><div id="toolbar"><a href="https://github.com/wmiksch/JMEWikiGerman/edit/master/src/docs/asciidoc/jme3/external/3dsmax.adoc"><i class="fa fa-pencil-square" aria-hidden="true"></i></a><a href="https://github.com/wmiksch/JMEWikiGerman/new/master/src/docs/asciidoc/jme3/external/"><i class="fa fa-plus-square" aria-hidden="true"></i></a><input dir="auto" style="position: relative; vertical-align: top;" spellcheck="false" autocomplete="off" class="searchbox__input aa-input" id="doc-search" name="search" placeholder="Search in the doc" required="required" type="search"></div><h1>3ds Max Bone Animation to JME3 using OgreMax plugin</h1><div class="details"><span class="author" id="author"></span><br><span id="revnumber">version ,</span> <span id="revdate">2016/03/17 20:48</span></div><div id="toc" class="toc2"><div id="toctitle">Inhaltsverzeichnis</div><ul class="sectlevel1"><li><a href="#asset-management">Asset Management</a></li><li><a href="#creating-models-in-3dsmax">Creating models in 3dsMax</a><ul class="sectlevel2"><li><a href="#create-model-and-bones">Create Model and Bones</a></li><li><a href="#create-the-animation">Create the animation</a></li><li><a href="#ogremax-settings">OgreMax settings</a></li><li><a href="#export-and-import">Export and Import</a></li><li><a href="#creating-a-character-in-3dsmax">Creating a character in 3dsMax</a></li><li><a href="#creating-a-simple-walk-animation">Creating a simple walk animation</a></li><li><a href="#preparing-the-export-and-setting-up-ogremax">Preparing the export and setting up OgreMax</a></li><li><a href="#fixing-the-location">Fixing the location</a></li><li><a href="#export-and-import-2">Export and Import</a></li></ul></li></ul></div></div><div id="content"><div class="sect1"><h2 id="asset-management">Asset Management</h2><div class="sectionbody"><div class="paragraph"><p>For the managing of assets in general, be sure to read the <a href="../../jme3/intermediate/multi-media_asset_pipeline.html">Asset Pipeline Documentation</a>. It contains vital information on how to manage your asset files.</p></div></div></div>
<div class="sect2"><h3 id="creating-models-in-3dsmax">Creating models in 3dsMax</h3><div class="paragraph"><p>For this tutorial I used 3D Studio Max 2012 and OgreMax 2.4.3 free edition</p></div>
<div class="sect2"><h3 id="create-model-and-bones">Create Model and Bones</h3><div class="ulist"><ul><li><p>Create a new file</p></li><li><p>Select the “Create” tab &gt; “Geometry” &gt; “Cylinder”</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax-0.png" alt="3dsmax-0.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p>Draw a cylinder, lets say with 8 height segments (must be enough for a smooth deformation)</p></li><li><p>Also check “Generate Mapping Coords.”</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax-1.png" alt="3dsmax-1.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p>Click “Create” tab &gt; “Systems” &gt; “Bones”</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax-2.png" alt="3dsmax-2.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p>Add some bones in the center of the cylinder</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax-3.png" alt="3dsmax-3.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p>Select the cylinder, right click it and click “Convert To:” &gt; “Convert to Editable Mesh” to prevent issues with OgreMax</p></li><li><p>Click the “Modify” tab &gt; “Modifier List” and add the “Skin” modifier</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax-4.png" alt="3dsmax-4.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p>Beneath “Bones:” click “Add” and select all of your bones</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax-5.png" alt="3dsmax-5.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p>You may also edit the envelopes, but for a small test the default settings are ok</p></li></ul></div></div>
<div class="sect2"><h3 id="create-the-animation">Create the animation</h3><div class="ulist"><ul><li><p>Select the cylinder, and click “Display” tab &gt; “Freeze Selected” so it is easier to select the bones during animation</p></li><li><p>Select the two top bones and enable the “Auto Key” mode</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax-6.png" alt="3dsmax-6.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p>The first key frame will be created automatically. Move the animation track slider to frame 5</p></li><li><p>Move the selected bones a bit. The cylinder mesh will be deformed. Because you are in the “Auto Key” mode, a key frame will be created</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax-7.png" alt="3dsmax-7.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p>Create some additional key frames. You may also select more bones and move or rotate them. I’ve created 25 frames and the last key frame equals the first, so the animation is loopable</p></li><li><p>After creating the animation, disable the “Auto Key” mode</p></li></ul></div></div>
<div class="sect2"><h3 id="ogremax-settings">OgreMax settings</h3><div class="ulist"><ul><li><p>Open the “OgreMax Scene Settings” dialog from the menu</p></li><li><p>In the “Meshes” tab, enable “Export XML Files” and disable “Export Binary Files” as well as “Export Vertex Colors”</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax-8.png" alt="3dsmax-8.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p>Click the “Environment” tab and uncheck “Export Environment Settings”. Otherwise the JME importer will throw a NullPointerException</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax-9.png" alt="3dsmax-9.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p>If you have textured your model, you may also check “Copy Bitmaps to Export Directory” in the “Bitmaps” tab</p></li><li><p>Unfreeze the cylinder by clicking “Display” tab &gt; “Unfreeze All” and select it</p></li><li><p>While having the cylinder selected, open the “OgreMax Object Settings” dialog from the menu</p></li><li><p>Open the “Mesh Animations” tab and select type “Skeleton”, “Export Skeleton” : “Yes”</p></li><li><p>Below “Mesh Animations” hit the “Add…” button</p></li><li><p>Assign a name to the track, maybe “wobble”. The track type must be “Skin. Set the right “Start/End Frames” for your animation</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax-10.png" alt="3dsmax-10.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p>Hit ok and you will see the animation in the table. You may add additional animations by selecting other frame ranges, if desired</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax-11.png" alt="3dsmax-11.png" width="" height=""></span></p></div></div>
<div class="sect2"><h3 id="export-and-import">Export and Import</h3><div class="ulist"><ul><li><p>When all animations are in the list, select “OgreMax” &gt; “Export” &gt; “Export Scene” and name the file “worm.scene”</p></li><li><p>Create a JME test class that imports the file, get the animation controller and start the “wobble” animation</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.jme3.animation.AnimChannel</span>;
<span class="keyword">import</span> <span class="include">com.jme3.animation.AnimControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.animation.Skeleton</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.SimpleApplication</span>;
<span class="keyword">import</span> <span class="include">com.jme3.asset.plugins.FileLocator</span>;
<span class="keyword">import</span> <span class="include">com.jme3.light.AmbientLight</span>;
<span class="keyword">import</span> <span class="include">com.jme3.light.PointLight</span>;
<span class="keyword">import</span> <span class="include">com.jme3.material.Material</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.ColorRGBA</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Geometry</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Node</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Spatial</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.control.LodControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.debug.SkeletonDebugger</span>;

<span class="comment">/**
 * This is a test class for loading a Ogre XML scene exported by OgreMax.
 *
 * @author Stephan Dreyer
 *
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestOgreMaxImport</span> <span class="directive">extends</span> SimpleApplication {

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> simpleInitApp() {
    assetManager.registerLocator(<span class="string"><span class="delimiter">&quot;</span><span class="content">Assets/model/ogre/test/</span><span class="delimiter">&quot;</span></span>, FileLocator.class);

    <span class="comment">// create the geometry and attach it</span>
    <span class="directive">final</span> Node model = (Node) assetManager.loadModel(<span class="string"><span class="delimiter">&quot;</span><span class="content">worm.scene</span><span class="delimiter">&quot;</span></span>);
    <span class="comment">// resize it, because of the large 3dsmax scales</span>
    model.setLocalScale(<span class="float">.001f</span>);

    <span class="comment">// attach to root node</span>
    rootNode.attachChild(model);
    addLodControl(model);

    <span class="directive">final</span> AnimControl ac = findAnimControl(model);

    <span class="keyword">try</span> {
      <span class="comment">// add a skeleton debugger to make bones visible</span>
      <span class="directive">final</span> <span class="predefined-type">Skeleton</span> skel = ac.getSkeleton();
      <span class="directive">final</span> SkeletonDebugger skeletonDebug = <span class="keyword">new</span> SkeletonDebugger(<span class="string"><span class="delimiter">&quot;</span><span class="content">skeleton</span><span class="delimiter">&quot;</span></span>,
          skel);
      <span class="directive">final</span> Material mat = <span class="keyword">new</span> Material(assetManager,
          <span class="string"><span class="delimiter">&quot;</span><span class="content">Common/MatDefs/Misc/Unshaded.j3md</span><span class="delimiter">&quot;</span></span>);
      mat.setColor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Color</span><span class="delimiter">&quot;</span></span>, ColorRGBA.Green);
      mat.getAdditionalRenderState().setDepthTest(<span class="predefined-constant">false</span>);
      skeletonDebug.setMaterial(mat);
      ((Node) ac.getSpatial()).attachChild(skeletonDebug);

      <span class="comment">// create a channel and start the wobble animation</span>
      <span class="directive">final</span> AnimChannel channel = ac.createChannel();
      channel.setAnim(<span class="string"><span class="delimiter">&quot;</span><span class="content">wobble</span><span class="delimiter">&quot;</span></span>);
    } <span class="keyword">catch</span> (<span class="directive">final</span> <span class="exception">Exception</span> e) {
      e.printStackTrace();
    }

    <span class="comment">// add some lights</span>
    rootNode.addLight(<span class="keyword">new</span> AmbientLight());
    rootNode.addLight(<span class="keyword">new</span> PointLight());
  }

  <span class="directive">public</span> <span class="type">void</span> addLodControl(<span class="directive">final</span> Spatial parent) {
    <span class="keyword">if</span> (parent <span class="keyword">instanceof</span> Node) {
      <span class="keyword">for</span> (<span class="directive">final</span> Spatial s : ((Node) parent).getChildren()) {
        addLodControl(s);
      }
    } <span class="keyword">else</span> <span class="keyword">if</span> (parent <span class="keyword">instanceof</span> Geometry) {
      <span class="directive">final</span> LodControl lc = <span class="keyword">new</span> LodControl();
      lc.setDistTolerance(<span class="float">1f</span>);
      parent.addControl(lc);
    }
  }

  <span class="comment">/**
   * Method to find the animation control, because it is not on the models root
   * node.
   *
   * @param parent
   *          The spatial to search.
   * @return The {@link AnimControl} or null if it does not exist.
   */</span>
  <span class="directive">public</span> AnimControl findAnimControl(<span class="directive">final</span> Spatial parent) {
    <span class="directive">final</span> AnimControl animControl = parent.getControl(AnimControl.class);
    <span class="keyword">if</span> (animControl != <span class="predefined-constant">null</span>) {
      <span class="keyword">return</span> animControl;
    }

    <span class="keyword">if</span> (parent <span class="keyword">instanceof</span> Node) {
      <span class="keyword">for</span> (<span class="directive">final</span> Spatial s : ((Node) parent).getChildren()) {
        <span class="directive">final</span> AnimControl animControl2 = findAnimControl(s);
        <span class="keyword">if</span> (animControl2 != <span class="predefined-constant">null</span>) {
          <span class="keyword">return</span> animControl2;
        }
      }
    }

    <span class="keyword">return</span> <span class="predefined-constant">null</span>;
  }

  <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="directive">final</span> <span class="predefined-type">String</span><span class="type">[]</span> args) {
    <span class="keyword">new</span> TestOgreMaxImport().start();
  }
}</code></pre></div></div>
<div class="paragraph"><p>You will see your worms strange movements. Have fun!</p></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax-12.png" alt="3dsmax-12.png" width="" height=""></span></p></div>
<div class="sect3"><h4 id="3ds-max-biped-animation-to-jme3">3ds Max Biped Animation to JME3</h4><div class="paragraph"><p>You can also use the biped operator to animate models, but you have to consider a lot of things.</p></div></div></div>
<div class="sect2"><h3 id="creating-a-character-in-3dsmax">Creating a character in 3dsMax</h3><div class="paragraph"><p>I will not tell you in detail how to model a character. There I many good tutorials on the web, I used <a href="http://majoh.deviantart.com/art/Mandi-s-3dsmax-Biped-Tutorial-26515784">that one</a>.</p></div>
<div class="ulist"><ul><li><p>You may create a biped before you start modeling, so it is quite easier to fit the proportions of the biped.</p></li><li><p>After creating a model and a biped I got something like that:</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/1.png" alt="1.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p>I added the “Meshmooth modifier with 2 iterations and got this result:</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax_biped_2.png" alt="3dsmax_biped_2.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p>After smoothing your mesh you could correct vertices with the “Edit Mesh modifier. Finally you add the “Physique modifier.</p></li><li><p>Now you can edit your envelopes to fit your model.</p></li></ul></div></div>
<div class="sect2"><h3 id="creating-a-simple-walk-animation">Creating a simple walk animation</h3><div class="ulist"><ul><li><p>Select the chest of your biped, choose “Motion (1) tab &gt; “Foot Step Mode (2) &gt; “Create Multiple Footsteps (3)</p></li><li><p>You need to select the “In Place Mode (4), so the character moves in place without changing its location.</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax_biped_3_1.png" alt="3dsmax_biped_3_1.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p>You can now play a bit with the settings, I adjusted “Actual Stride Length and “Actual Stride Height.</p></li><li><p>For the “Number of Footsteps 6 will be sufficient because the animation is cycled later.</p></li><li><p><strong>Note:</strong> You can also create or edit footsteps by hand and move or rotate them.</p></li><li><p>After all footsteps are created, hit the “Create Keys for Inactive Footsteps button in the “Footstep Operations panel</p></li><li><p>You can now check your animation by pressing the “Play button in the timeline.</p></li></ul></div></div>
<div class="sect2"><h3 id="preparing-the-export-and-setting-up-ogremax">Preparing the export and setting up OgreMax</h3><div class="ulist"><ul><li><p>The “OgreMax Scene Settings should be the same as shown above.</p></li><li><p>Because you want your animation to be looped, you&#8217;ve got to find two key frames where the legs are nearly in the same position. For my settings I&#8217;ve chosen the frames 48-78 for the walk animation.</p></li><li><p>Select the character mesh and open the “OgreMax Scene Settings dialog.</p></li><li><p>Open the “Mesh Animations” tab and select type “Skeleton”, “Export Skeleton” : “Yes”</p></li><li><p>Below “Mesh Animations” hit the “Add…” button</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax_biped_4.png" alt="3dsmax_biped_4.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p>Enter a name for the track, e.g. “walk.</p></li><li><p>Assure the track type is set to “Physique.</p></li><li><p>Set the start and end frames, for me it is 48-78.</p></li><li><p>Close the dialog by pushing “Ok.</p></li><li><p><strong>Note:</strong> It could be useful to create also a track “start_run, that blends between the stand and walk animation. I would use frame 0-47 for that.</p></li><li><p>Because you have a smooth model with a lot of polygons, it may be useful to create <a href="../../jme3/advanced/mesh.html">levels of detail (LOD)</a>. When the camera is farther away, a low-poly mesh of your character will be rendered.</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax_biped_5.png" alt="3dsmax_biped_5.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p>Open the “Mesh LOD tab in object settings.</p></li><li><p>It will suffice to select the “Automatic setting, but if your animation starts to look weird, you can create them by hand.</p></li><li><p>I used 4 levels of LOD with a distance of 1. Don&#8217;t worry about the distance setting, you can change it later in JME.</p></li><li><p>For the level reduction, I used 20 percent, which produce good results. You may adjust all the settings depending on your needs.</p></li><li><p>Close the dialoque by clicking “Ok.</p></li></ul></div></div>
<div class="sect2"><h3 id="fixing-the-location">Fixing the location</h3><div class="ulist"><ul><li><p>Before you export you need to do a little fix, because your model is not really located where you see it. JME will get into a lot of trouble, if you don&#8217;t change that.</p></li><li><p>Assure to save the max file. Sometimes OgreMax crashes the whole application during export. If you want to change the animation after export, you should reload this file because fixing the location changes something I can&#8217;t really figure out.</p></li></ul></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax_biped_6.png" alt="3dsmax_biped_6.png" width="" height=""></span></p></div>
<div class="ulist"><ul><li><p>Right click the “Select and Move tool in the upper toolbar. A dialog will pop up.</p></li><li><p>Set the X and Y location to 0 and close the dialog.</p></li><li><p>There is another way to achieve this. If you have scaled, moved or rotated your model, just open the “Hierarchy tab and click “Transform and “Scale on the “Reset panel.</p></li></ul></div></div>
<div class="sect2"><h3 id="export-and-import-2">Export and Import</h3><div class="ulist"><ul><li><p>Now you can export your scene. Select only the mesh and use “Export selected objects. You will not need the whole scene including the biped object, but the bones are created automatically during export.</p></li><li><p>Create a JME test class for the scene import.</p></li></ul></div>
<div class="paragraph"><p>For that, I extended the first class:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.jme3.animation.AnimChannel</span>;
<span class="keyword">import</span> <span class="include">com.jme3.animation.AnimControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.animation.Skeleton</span>;
<span class="keyword">import</span> <span class="include">com.jme3.app.SimpleApplication</span>;
<span class="keyword">import</span> <span class="include">com.jme3.asset.plugins.FileLocator</span>;
<span class="keyword">import</span> <span class="include">com.jme3.light.AmbientLight</span>;
<span class="keyword">import</span> <span class="include">com.jme3.light.PointLight</span>;
<span class="keyword">import</span> <span class="include">com.jme3.material.Material</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.ColorRGBA</span>;
<span class="keyword">import</span> <span class="include">com.jme3.math.Vector3f</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Geometry</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Node</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.Spatial</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.control.LodControl</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.debug.SkeletonDebugger</span>;
<span class="keyword">import</span> <span class="include">com.jme3.scene.shape.Box</span>;

<span class="comment">/**
 * This is a test class for loading a Ogre XML scene exported by OgreMax.
 *
 * @author Stephan Dreyer
 *
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestOgreMaxImport</span> <span class="directive">extends</span> SimpleApplication {

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> simpleInitApp() {
    assetManager.registerLocator(<span class="string"><span class="delimiter">&quot;</span><span class="content">Assets/model/ogre/test/</span><span class="delimiter">&quot;</span></span>, FileLocator.class);

    <span class="comment">// create the geometry and attach it</span>
    <span class="directive">final</span> Node model = (Node) assetManager.loadModel(<span class="string"><span class="delimiter">&quot;</span><span class="content">guy.scene</span><span class="delimiter">&quot;</span></span>);
    <span class="comment">// resize it, because of the large 3dsmax scales</span>
    model.setLocalScale(<span class="float">.02f</span>);

    <span class="comment">// attach to root node</span>
    rootNode.attachChild(model);
    addLodControl(model);

    <span class="directive">final</span> AnimControl ac = findAnimControl(model);

    <span class="keyword">try</span> {
      <span class="comment">// add a skeleton debugger to make bones visible</span>
      <span class="directive">final</span> <span class="predefined-type">Skeleton</span> skel = ac.getSkeleton();
      <span class="directive">final</span> SkeletonDebugger skeletonDebug = <span class="keyword">new</span> SkeletonDebugger(<span class="string"><span class="delimiter">&quot;</span><span class="content">skeleton</span><span class="delimiter">&quot;</span></span>,
          skel);
      <span class="directive">final</span> Material mat = <span class="keyword">new</span> Material(assetManager,
          <span class="string"><span class="delimiter">&quot;</span><span class="content">Common/MatDefs/Misc/Unshaded.j3md</span><span class="delimiter">&quot;</span></span>);
      mat.setColor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Color</span><span class="delimiter">&quot;</span></span>, ColorRGBA.Green);
      mat.getAdditionalRenderState().setDepthTest(<span class="predefined-constant">false</span>);
      skeletonDebug.setMaterial(mat);
      ((Node) ac.getSpatial()).attachChild(skeletonDebug);

      <span class="comment">// create a channel and start the walk animation</span>
      <span class="directive">final</span> AnimChannel channel = ac.createChannel();
      channel.setAnim(<span class="string"><span class="delimiter">&quot;</span><span class="content">walk</span><span class="delimiter">&quot;</span></span>);
    } <span class="keyword">catch</span> (<span class="directive">final</span> <span class="exception">Exception</span> e) {
      e.printStackTrace();
    }

    flyCam.setMoveSpeed(<span class="float">40f</span>);
    cam.setLocation(<span class="keyword">new</span> Vector3f(<span class="integer">15</span>, <span class="integer">10</span>, <span class="integer">15</span>));
    cam.lookAt(Vector3f.ZERO, Vector3f.UNIT_Y);
    cam.setFrustumNear(<span class="float">1f</span>);

    <span class="comment">// add some lights</span>
    rootNode.addLight(<span class="keyword">new</span> AmbientLight());

    <span class="directive">final</span> PointLight pl = <span class="keyword">new</span> PointLight();
    pl.setPosition(<span class="keyword">new</span> Vector3f(-<span class="float">3f</span>, <span class="float">3f</span>, <span class="float">1f</span>));
    rootNode.addLight(pl);

    <span class="comment">// add a box as floor</span>
    <span class="directive">final</span> <span class="predefined-type">Box</span> b = <span class="keyword">new</span> <span class="predefined-type">Box</span>(<span class="float">100f</span>, <span class="float">0.1f</span>, <span class="float">100f</span>);
    <span class="directive">final</span> Geometry geo = <span class="keyword">new</span> Geometry(<span class="string"><span class="delimiter">&quot;</span><span class="content">floor</span><span class="delimiter">&quot;</span></span>, b);

    <span class="directive">final</span> Material mat = <span class="keyword">new</span> Material(assetManager,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Common/MatDefs/Misc/Unshaded.j3md</span><span class="delimiter">&quot;</span></span>);
    mat.setColor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Color</span><span class="delimiter">&quot;</span></span>, ColorRGBA.LightGray);
    geo.setMaterial(mat);

    rootNode.attachChild(geo);
  }

  <span class="comment">/**
   * Method to traverse through the scene graph and add a {@link LodControl} to
   * the mesh.
   *
   * @param parent
   *          The Node to add the control to.
   */</span>
  <span class="directive">public</span> <span class="type">void</span> addLodControl(<span class="directive">final</span> Spatial parent) {
    <span class="keyword">if</span> (parent <span class="keyword">instanceof</span> Node) {
      <span class="keyword">for</span> (<span class="directive">final</span> Spatial s : ((Node) parent).getChildren()) {
        addLodControl(s);
      }
    } <span class="keyword">else</span> <span class="keyword">if</span> (parent <span class="keyword">instanceof</span> Geometry) {
      <span class="directive">final</span> LodControl lc = <span class="keyword">new</span> LodControl();

      <span class="comment">// the distance for LOD changes is set here, you may adjust this</span>
      lc.setDistTolerance(<span class="float">1f</span>);
      parent.addControl(lc);
    }
  }

  <span class="comment">/**
   * Method to find the animation control, because it is not on the models root
   * node.
   *
   * @param parent
   *          The spatial to search.
   * @return The {@link AnimControl} or null if it does not exist.
   */</span>
  <span class="directive">public</span> AnimControl findAnimControl(<span class="directive">final</span> Spatial parent) {
    <span class="directive">final</span> AnimControl animControl = parent.getControl(AnimControl.class);
    <span class="keyword">if</span> (animControl != <span class="predefined-constant">null</span>) {
      <span class="keyword">return</span> animControl;
    }

    <span class="keyword">if</span> (parent <span class="keyword">instanceof</span> Node) {
      <span class="keyword">for</span> (<span class="directive">final</span> Spatial s : ((Node) parent).getChildren()) {
        <span class="directive">final</span> AnimControl animControl2 = findAnimControl(s);
        <span class="keyword">if</span> (animControl2 != <span class="predefined-constant">null</span>) {
          <span class="keyword">return</span> animControl2;
        }
      }
    }

    <span class="keyword">return</span> <span class="predefined-constant">null</span>;
  }

  <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="directive">final</span> <span class="predefined-type">String</span><span class="type">[]</span> args) {
    <span class="keyword">new</span> TestOgreMaxImport().start();
  }
}</code></pre></div></div>
<div class="paragraph"><p>After starting the class, you can see a nice smooth walk animation (if it&#8217;s not smooth, you need to adjust your track frames):</p></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax_biped_7.png" alt="3dsmax_biped_7.png" width="" height=""></span></p></div>
<div class="paragraph"><p>As you can see, the LOD is working:</p></div>
<div class="paragraph"><p><span class="image"><img src="../../jme3/external/3dsmax_biped_8.png" alt="3dsmax_biped_8.png" width="" height=""></span></p></div></div></div></div><div id="footer"><div id="footer-text">Version <br>Last updated 2020-06-11 12:23:11 +00:00</div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script>docsearch({
  apiKey: 'a736b6d93de805e26ec2f49b55013fbd',
  indexName: 'jmonkeyengine',
  inputSelector: '#doc-search',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></body></html>