<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Asciidoctor 1.5.4"><title>Sending and receiving messages</title><link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"><link rel="stylesheet" href="/home/travis/build/wmiksch/JMEWikiGerman/build/asciidoc/html5/spidermonkey/tutorial/twemoji-awesome.css"></head><body class="article toc2 toc-left"><div id="header"><div id="toolbar"><a href="https://github.com/wmiksch/JMEWikiGerman/edit/master/src/docs/asciidoc/spidermonkey/tutorial/sending_and_receiving_messages.adoc"><i class="fa fa-pencil-square" aria-hidden="true"></i></a><a href="https://github.com/wmiksch/JMEWikiGerman/new/master/src/docs/asciidoc/spidermonkey/tutorial/"><i class="fa fa-plus-square" aria-hidden="true"></i></a><input dir="auto" style="position: relative; vertical-align: top;" spellcheck="false" autocomplete="off" class="searchbox__input aa-input" id="doc-search" name="search" placeholder="Search in the doc" required="required" type="search"></div><h1>Sending and receiving messages</h1><div class="details"><span class="author" id="author"></span><br><span id="revnumber">version ,</span> <span id="revdate">2016/03/17 20:48</span></div><div id="toc" class="toc2"><div id="toctitle">Inhaltsverzeichnis</div><ul class="sectlevel1"><li><a href="#serializable-annotation">Serializable annotation</a></li></ul></div></div><div id="content"><div id="preamble"><div class="sectionbody"><div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa icon-warning" title="Warning"></i></td><td class="content"><div class="paragraph"><p>This article covers a deprecated <abbr title="Application Programming Interface">API</abbr>! See <a href="../../jme3/advanced/networking.html">networking</a> for current documentation.</p></div></td></tr></table></div>
<div class="paragraph"><p>In this tutorial I&#8217;m going to cover sending and receiving messages. I&#8217;ll also explain how to write your own messages. This tutorial assumes you already have a working server-client connection.</p></div>
<div class="paragraph"><p>Let&#8217;s start by creating our own message. Later on we&#8217;ll send this across the network.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Serializable</span>()
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloMessage</span> <span class="directive">extends</span> Message {
   <span class="directive">public</span> <span class="predefined-type">String</span> hello = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello!</span><span class="delimiter">&quot;</span></span>;
}</code></pre></div></div>
<div class="paragraph"><p>This is probably the smallest and simplest message you&#8217;ll find. This is simply the process of creating a class, extending Message, and adding your fields to it. Also you need the @Serializable annotation, but we&#8217;ll get to that later. Even though you don&#8217;t <strong>have to</strong> extend Message, you generally should since then SpiderMonkey can add client and connection information on receiving. You can also send separate data, but we&#8217;ll not go into that here - you should just send Messages.</p></div>
<div class="paragraph"><p>Now let&#8217;s send this message across the network. We&#8217;ll send it from the client to the server.</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java">Serializer.registerClass(HelloMessage.class);
server.addMessageListener(<span class="local-variable">this</span>, HelloMessage.class);
client.addMessageListener(<span class="local-variable">this</span>, HelloMessage.class);
client.send(<span class="keyword">new</span> HelloMessage());</code></pre></div></div>
<div class="paragraph"><p>First we&#8217;ve registered the class to the Serializer. This needs to happen on both the client and server, I&#8217;ll explain why in the next tutorial. Then we add the message listeners for both the server and client, this makes sure we&#8217;re notified when messages are received. Then we send the message. The message is by default reliable, and so it will be sent over TCP. Now we&#8217;ll handle it on the server:</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> messageReceived(Message message) {
   <span class="comment">// This message is of type HelloMessage, so we don't have to check.</span>
   HelloMessage helloMessage = (HelloMessage)message;
   <span class="predefined-type">System</span>.out.println(helloMessage.hello);
   helloMessage.hello = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hi!</span><span class="delimiter">&quot;</span></span>;
   message.getClient().send(helloMessage);
}</code></pre></div></div>
<div class="paragraph"><p>This simply receives the message, and changes the Hello! to Hi! and sends it back to the client. The client, can of course handle this message however it wants to.</p></div></div></div>
<div class="sect1"><h2 id="serializable-annotation">Serializable annotation</h2><div class="sectionbody"><div class="paragraph"><p>The Serializable annotation is used to determine which serializer you want to use for your message, and which ID you want to register to it. If you specify no ID and no serializer, a ID will be assigned, and the default serializer will be used. The problem with specifying no ID is that you have to have the same order of registration on both the client and server, otherwise serializing will go wrong. It&#8217;s therefore advisable that you use the id field, if you want to register classes in a different order.</p></div>
<div class="paragraph"><p>The default serializer is, of course, FieldSerializer, which&#8217;ll do just fine for just about any message you can throw at it. However, if you wish to serialize your message yourself, all you must do is write your own serializer, and then pass the class to the serializer field in the annotation. For example, this Serializable annotation sets ID to four, and serializer to CustomSerializer (which doesn&#8217;t exist, mind you).</p></div>
<div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Serializable</span>(id=<span class="integer">4</span>, serializer=CustomSerializer.class)</code></pre></div></div>
<div class="paragraph"><p>That was it! The next tutorial explains how the Serializer system works, and how you can register your own serializers!</p></div></div></div></div><div id="footer"><div id="footer-text">Version <br>Last updated 2020-05-23 13:25:31 +00:00</div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script>docsearch({
  apiKey: 'a736b6d93de805e26ec2f49b55013fbd',
  indexName: 'jmonkeyengine',
  inputSelector: '#doc-search',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></body></html>